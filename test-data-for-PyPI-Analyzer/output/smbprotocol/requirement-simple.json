{
  "name": "smbprotocol",
  "description": "# smbprotocol\nSMBv2 and v3 Client for both Python 2 and 3.\n\n\n[![Build Status](https://dev.azure.com/jborean93/jborean93/_apis/build/status/jborean93.smbprotocol?branchName=master)](https://dev.azure.com/jborean93/jborean93/_build/latest?definitionId=4&branchName=master)\n[![codecov](https://codecov.io/gh/jborean93/smbprotocol/branch/master/graph/badge.svg)](https://codecov.io/gh/jborean93/smbprotocol)\n[![PyPI version](https://badge.fury.io/py/smbprotocol.svg)](https://badge.fury.io/py/smbprotocol)\n[![License](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/jborean93/smbprotocol/blob/master/LICENSE)\n\nSMB is a network file sharing protocol and has numerous iterations over the\nyears. This library implements the SMBv2 and SMBv3 protocol based on the\n[MS-SMB2](https://msdn.microsoft.com/en-us/library/cc246482.aspx) document.\n\n\n## Features\n\n* Negotiation of the SMB 2.0.2 protocol to SMB 3.1.1 (Windows 10/Server 2016)\n* Authentication with both NTLM and Kerberos\n* Message signing\n* Message encryption (SMB 3.x.x+)\n* Connect to a Tree/Share\n* Opening of files, pipes and directories\n* Set create contexts when opening files\n* Read and writing of files and pipes\n* Sending IOCTL commands\n* Sending of multiple messages in one packet (compounding)\n* Experimental support for both standalone and DFS server shares\n\nThis is definitely not feature complete as SMB is quite a complex protocol, see\nbacklog for features that would be nice to have in this library.\n\n\n## Requirements\n\n* Python 2.7, 3.5+\n* For Kerberos auth on Linux\n    * [python-gssapi](https://github.com/pythongssapi/python-gssapi)\n\nTo use Kerberos authentication on Linux, further dependencies are required, to install these dependencies run\n\n```bash\n# for Debian/Ubuntu/etc:\nsudo apt-get install gcc python-dev libkrb5-dev\npip install smbprotocol[kerberos]\n\n# for RHEL/CentOS/etc:\nsudo yum install gcc python-devel krb5-devel krb5-workstation python-devel\npip install smbprotocol[kerberos]\n```\n\nKerberos auth with Windows should just work out of the box with the `pyspnego` library but on Linux, the\n`python-gssapi` library must be installed and `smbprotocol` requires a particular GSSAPI extension to be available to\nwork. This extension should be installed on the majority of MIT or Heimdal Kerberos installs but that is not a\nguarantee. To verify that Kerberos is available on Linux you can run the following check in a Python console:\n\n```python\ntry:\n    from gssapi.raw import inquire_sec_context_by_oid\n    print(\"python-gssapi extension is available\")\nexcept ImportError as exc:\n    print(\"python-gssapi extension is not available: %s\" % str(exc))\n```\n\nIf it isn't available, then either a newer version of the system's gssapi implementation needs to be setup and\npython-gssapi compiled against that newer version. In the absence of this extension, only NTLM auth is used.\n\n\n## Installation\n\nTo install smbprotocol, simply run\n\n```bash\npip install smbprotocol\n\n# To install with Kerberos support\npip install smbprotocol[kerberos]\n```\n\nThis will download the required packages that are used in this package and get\nyour Python environment ready to go.\n\n\n## Additional Info\n\nOne of the first steps as part of the SMB protocol is to negotiate the dialect\nused and other features that are available. Currently smbprotocol supports\nthe following dialects;\n\n* `2.0.0`: Added with Server 2008/Windows Vista\n* `2.1.0`: Added with Server 2008 R2/Windows 7\n* `3.0.0`: Added with Server 2012/Windows 8\n* `3.0.2`: Added with Server 2012 R2/Windows 8.1\n* `3.1.1`: Added with Server 2016/Windows10\n\nEach dialect adds in more features to the protocol where some are minor but\nsome are major. One major changes is in Dialect 3.x where it added message\nencryption. Message encryption is set to True by default and needs to be\noverridden when creating a Session object for the older dialects.\n\nBy default, the negotiation process will use the latest dialect that is\nsupported by the server but this can be overridden if required. When this is\ndone by the following code\n\n```python\nimport uuid\n\nfrom smbprotocol.connection import Connection, Dialects\n\nconnection = Connection(uuid.uuid4(), \"server\", 445)\nconnection.connect(Dialects.SMB_3_0_2)\n```\n\nWhile you shouldn't want to downgrade to an earlier version, this does allow\nyou to set a minimum dialect version if required.\n\n\n## Examples\n\nThere are 2 different APIs you can use with this library.0\n\n* `smbprotocol`: Low level interface that can do whatever you want but quite verbose\n* `smbclient`: Higher level interface that implements the builtin `os` and `os.path` file system functions but for SMB support\n\nThe `examples` folder contains some examples of both the high and low level\ninterface but for everyday user's it is recommended to use `smbclient` as it\nis a lot simpler.\n\n### smbclient Interface\n\nThe higher level interface `smbclient` is designed to make this library easier\nfor people to use for simple and common use cases. It is designed to replicate\nthe builtin `os` and `os.path` filesystem functions like `os.open()`,\n`os.stat()`, and `os.path.exists()`. It is also designed to handle connections\nto a DFS target unlike `smbprotocol`.\n\nA connection made by `smbclient` is kept in a pool and re-used for future\nrequests to the same server until the Python process exists. This makes\nauthentication simple and only required for the first call to the server. Any\nDFS referrals are also cached in that Python process. This optimises any\nfuture requests to that same DFS namespace.\n\nThe functions in `smbclient` have a global config object that can be used to\nset any connection defaults to use for any future connections. It can also be\nused to specify any domain based DFS settings for more advanced setups. It is\nrecommended to use `ClientConfig()` to set any global credentials like so:\n\n```python\nimport smbclient\n\nsmbclient.ClientConfig(username='user', password='password')\n```\n\nThe `ClientConfig` is a singleton and any future instanciations of that\nobject will just update the keys being set. You can set the following keys on\nthe `ClientConfig`:\n\n* `client_guid`: The client GUID to identify the client to the server on a new connection\n* `username`: The default username to use when creating a new SMB session if explicit credentials weren't set\n* `password`: The default password to use for authentication\n* `domain_controller`: The domain controller hostname. This is useful for environments with DFS servers as it is used to identify the DFS domain information automatically\n* `skip_dfs`: Whether to skip doing any DFS resolution, useful if there is a bug or you don't want to waste any roundtrip requesting referrals\n* `auth_protocol`: The authentication protocol to use; `negotiate` (default), `kerberos`, or `ntlm`\n* `require_secure_negotiate`: Control whether the client validates the negotiation info when connecting to a share (default: `True`).\n    * More information can be found on [SMB3 Secure Dialect Negotiation](https://docs.microsoft.com/en-us/archive/blogs/openspecification/smb3-secure-dialect-negotiation)\n\nAs well as setting the default credentials on the `ClientConfig` you can also\nspecify the credentials and other connection parameters on each `smbclient`\nfunction or when registering a new server. These functions accept the\nfollowing kwargs:\n\n* `username`: The username used to connect to the share\n* `password`: The password used to connect to the share\n* `port`: Override the default port (`445`) to connect to\n* `encrypt`: Whether to force encryption on the connection, requires SMBv3 or newer on the remote server (default: `False`)\n* `connection_timeout`: Override the connection timeout in seconds (default: `60`)\n\nIf using Kerberos authentication and a Kerberos ticket has already set by\n`kinit` then `smbclient` will automatically use those credentials without\nhaving to be explicitly set. If no ticket has been retrieved or you wish to use\ndifferent credentials then set the default credentials on the `ClientConfig`\nor specify `username` and `password` on the first request to the server.\n\nFor example I only need to set the credentials on the first request to create\nthe directory and not for the subsequent file creation in that dir.\n\n```python\nimport smbclient\n\n# Optional - specify the default credentials to use on the global config object\nsmbclient.ClientConfig(username='user', password='pass')\n\n# Optional - register the credentials with a server (overrides ClientConfig for that server)\nsmbclient.register_session(\"server\", username=\"user\", password=\"pass\")\n\nsmbclient.mkdir(r\"\\\\server\\share\\directory\", username=\"user\", password=\"pass\")\n\nwith smbclient.open_file(r\"\\\\server\\share\\directory\\file.txt\", mode=\"w\") as fd:\n    fd.write(u\"file contents\")\n```\n\nIf you wish to reset the cache you can either start a new Python process or\ncall `smbclient.reset_connection_cache()` to close all the connections that\nhave been cached by the client.\n\n\n## Logging\n\nThis library makes use of the builtin Python logging facilities. Log messages\nare logged to the `smbprotocol` named logger as well as `smbprotocol.*` where\n`*` is each python script in the `smbprotocol` directory.\n\nThese logs are really useful when debugging issues as they give you a more\nstep by step snapshot of what it is doing and what may be going wrong. The\ndebug side will also print out a human readable string of each SMB packet that\nis sent out from the client so it can get very verbose.\n\n\n## Testing\n\nTo this module, you need to install some pre-requisites first. This can be done\nby running;\n\n```bash\npip install -r requirements-test.txt\n\n# you can also run tox by installing tox\npip install tox\n```\n\nFrom there to run the basic tests run;\n\n```bash\npy.test -v --pep8 --cov smbprotocol --cov-report term-missing\n\n# or with tox 2.7, 2.7, 3.4, 3.5, and 3.6\ntox\n```\n\nThere are extra tests that only run when certain environment variables are set.\nTo run these tests set the following variables;\n\n* `SMB_USER`: The username to authenticate with\n* `SMB_PASSWORD`: The password to authenticate with\n* `SMB_SERVER`: The IP or hostname of the server to authenticate with\n* `SMB_PORT`: The port the SMB server is listening on, default is `445`\n* `SMB_SHARE`: The name of the share to connect to, a share with this name must exist as well as a share with the name`$SMB_SHARE-encrypted` must also exist that forces encryption\n\nFrom here running `tox` or `py.test` with these environment variables set will\nactivate the integration tests.\n\nThis requires either Windows 10 or Server 2016 as they support Dialect 3.1.1\nwhich is required by the tests.\n\nIf you don't have access to a Windows host, you can use Docker to setup a\nSamba container and use that as part of the tests. To do so run the following\nbash commands;\n\n```bash\nexport SMB_USER=smbuser\nexport SMB_PASSWORD=smbpassword\nexport SMB_PORT=445\nexport SMB_SERVER=localhost\nexport SMB_SHARE=share\n\ndocker run \\\n    --detach \\\n    --rm \\\n    --privileged=true \\\n    -p $SMB_PORT:445 \\\n    -v $(pwd)/build-scripts:/app \\\n    -w /app \\\n    -e SMB_USER=$SMB_USER \\\n    -e SMB_PASSWORD=$SMB_PASSWORD \\\n    -e SMB_SHARE=$SMB_SHARE \\\n    centos:7 \\\n    /bin/bash /app/setup_samba.sh\n```\n\n\n## Backlog\n\nHere is a list of features that I would like to incorporate, PRs are welcome\nif you want to implement them yourself;\n\n* Multiple channel support to speed up large data transfers\n* Lots and lots more...\n\n\n",
  "requires_dist": [
    "cryptography (>=2.0)",
    "pyspnego",
    "six",
    "gssapi (>=1.4.1) ; (sys_platform!=\"win32\") and extra == 'kerberos'"
  ],
  "requires_python": ">=2.7,!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,!=3.4.*",
  "current_version": "1.5.0",
  "released_versions": [
    "0.0.1.dev0",
    "0.0.1.dev1",
    "0.0.1.dev2",
    "0.0.1.dev3",
    "0.0.1.dev4",
    "0.0.1.dev5",
    "0.0.1.dev6",
    "0.1.0",
    "0.1.1",
    "0.2.0",
    "1.0.0",
    "1.0.0b1",
    "1.0.1",
    "1.1.0",
    "1.1.0rc1",
    "1.1.0rc2",
    "1.2.0",
    "1.3.0",
    "1.4.0",
    "1.5.0"
  ]
}